#!/bin/bash

set -euo pipefail

echo "Debug: Starting pre-checkout hook"

# Log all BUILDKITE_PLUGIN_CUSTOM_CHECKOUT_* variables
env | grep BUILDKITE_PLUGIN_CUSTOM_CHECKOUT_ || echo "No BUILDKITE_PLUGIN_CUSTOM_CHECKOUT_* variables set"

# Set variables, defaulting to current BUILDKITE_* values if not set
CUSTOM_REPO="${BUILDKITE_PLUGIN_CUSTOM_CHECKOUT_REPOSITORY:-$BUILDKITE_REPO}"
CUSTOM_BRANCH="${BUILDKITE_PLUGIN_CUSTOM_CHECKOUT_BRANCH:-$BUILDKITE_BRANCH}"
CUSTOM_COMMIT="${BUILDKITE_PLUGIN_CUSTOM_CHECKOUT_COMMIT:-$BUILDKITE_COMMIT}"

echo "Custom checkout configured:"
echo "Repository: ${CUSTOM_REPO}"
echo "Branch: ${CUSTOM_BRANCH}"
echo "Commit: ${CUSTOM_COMMIT}"

# Export for use in subsequent steps
export BUILDKITE_REPO="$CUSTOM_REPO"
export BUILDKITE_BRANCH="$CUSTOM_BRANCH"
export BUILDKITE_COMMIT="$CUSTOM_COMMIT"

echo "Debug: Ending pre-checkout hook"
